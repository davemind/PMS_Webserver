<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Permission Setting</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="static/menu-table/plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="static/menu-table/dist/css/adminlte.min.css">

</head>

<script>
function load(){
	$.ajax({
		url: "/bk/Permission/Menu",
		type: "POST",
		error: function (result) {
			alert("There is a Problem, Try Again!");
		},
		success: function (result) {
			var data = JSON.parse(result);
			if(data['statusCode'] == '403'){
				top.location="/"
			}
			else {
				menu_items = data['menu_items']
				table_items = data['table_items']
				users = data['users']
				groups = data['groups']
				var menu = document.getElementById("menu");
				for (var i = 0; i < menu_items.length; ++i) {
					var item=document.createElement("li");
					item.setAttribute("class","nav-item d-none d-sm-inline-block");
					var A = document.createElement("A");
					A.setAttribute("href", menu_items[i][1]);
					A.setAttribute("class","nav-link");
					A.appendChild(document.createTextNode(menu_items[i][0]));
					item.appendChild(A);
					menu.appendChild(item);
				}
				var tbody = document.getElementById("table").getElementsByTagName("tbody")[0];
				for (var i = 0; i < table_items.length; ++i) {
					var row = document.createElement("tr");
					for (var j = 1; j < table_items[i].length; ++j) {
						var data1 = document.createElement("td");
						data1.appendChild(document.createTextNode(table_items[i][j]));
						row.appendChild(data1);
					}
					var data = document.createElement("td");
					var data1 = document.createElement("button");
					data1.setAttribute("type", "button");
					data1.setAttribute("style", "padding:1px;border: aliceblue;background: white;");
					data1.setAttribute("onclick", "delete_permission(" + table_items[i][0] + ")");
					var image = document.createElement("img");
					image.setAttribute("src", "static/images/icons/delete.jpg");
					image.setAttribute("width", 20);
					image.setAttribute("height", 20);
					data1.appendChild(image);
					data.appendChild(data1);
					row.appendChild(data);
					tbody.appendChild(row);
				}
				var row = document.createElement("tr");
				var data1 = document.createElement("td");
				var data_select = document.createElement("select");
				data_select.setAttribute("class", "form-control custom-select");
				data_select.setAttribute("id", "selected_user");
				for (var j = 0; j < users.length; ++j) {
					data_select.options[data_select.options.length] = new Option(users[j], users[j]);
				}
				data1.appendChild(data_select);
				row.appendChild(data1);
				var data1 = document.createElement("td");
				var data_select = document.createElement("select");
				data_select.setAttribute("class", "form-control custom-select");
				data_select.setAttribute("id", "selected_group");
				for (var j = 0; j < groups.length; ++j) {
					data_select.options[data_select.options.length] = new Option(groups[j], groups[j]);
				}
				data1.appendChild(data_select);
				row.appendChild(data1);
				var data = document.createElement("td");
				var data1 = document.createElement("button");
				data1.setAttribute("type", "button");
				data1.setAttribute("style", "padding:1px;border: aliceblue;background: white;");
				data1.setAttribute("onclick", "add_permission()");
				var image = document.createElement("img");
				image.setAttribute("src", "static/images/icons/add.jpg");
				image.setAttribute("width", 20);
				image.setAttribute("height", 20);
				data1.appendChild(image);
				data.appendChild(data1);
				row.appendChild(data);
				tbody.appendChild(row);

				$("#table").DataTable({
				  "paging": true,
				  "lengthChange": true,
				  "fixedHeader": true,
				  "ordering": true,
				  "aLengthMenu": [[10, 20, 30, 50, -1], [10, 20, 30, 50, 'All']],
				  "info": true,
				  "autoWidth": false,
				  "responsive": true,
				});
			}
		},
	});
}
function add_permission(){
	$.ajax({
		url: "/bk/Permission",
		type: "POST",
		data: {
			user: document.getElementById("selected_user").value,
			group: document.getElementById("selected_group").value,
		},
		error: function (result) {
			alert("There is a Problem, Try Again!");
		},
		success: function (result) {
			var data = JSON.parse(result);
			if(data['statusCode'] == '400'){
				if(data['message'] == 'group'){
					alert("Wrong group name!");
				}
				else{
					alert("Wrong user name!");
				}
			}
			location.reload();
		}
	});
}
function delete_permission(id){
	$.ajax({
		url: "/bk/Permission",
		type: "DELETE",
		data: {
			id: id,
		},
		error: function (result) {
			alert("There is a Problem, Try Again!");
		},
		success: function (result) {
			location.reload();
		}
	});
}
</script>

<body  class="hold-transition sidebar-mini" onload="load()">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav" id="menu">
    </ul>
  </nav>	
  <div class="card-body">
	<table id="table" class="table table-bordered table-hover">
	  <thead>
	  <tr>
		<th>user</th>
		<th>group</th>
		<th>Action</th>
	  </tr>
	  </thead>
	  <tbody>
	  </tbody>
	</table>
  </div>

	
<!-- jQuery -->
<script src="static/menu-table/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="static/menu-table/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables  & Plugins -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/fixedheader/3.1.7/js/dataTables.fixedHeader.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.1.7/css/fixedHeader.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css" />
<script>
  $(function () {
    $('#example2').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": false,
      "ordering": true,
      "info": true,
      "autoWidth": false,
      "responsive": true,
    });
  });
</script>
</body>
</html>
